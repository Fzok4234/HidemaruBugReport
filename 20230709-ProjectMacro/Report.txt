プロジェクト上のマクロから.hmbookファイル等のパスを取得する方法



いつもお世話になっております。Fzok4234 です。


さて、プロジェクトの .hmbook ファイル上でファイルパスの所に mac: で始まるマクロの文を
記述する際に、この .hmbook ファイル自身やその親ディレクトリのパスを取得する必要が出て
きたのですが、どうすればよいのでしょうか ?

実際に
https://github.com/Fzok4234/HidemaruBugReport/blob/master/20230709-ProjectMacro/Test.hmbook
( U+0002 制御文字を含んでいるため必ず git clone か又はサイトの Download raw file ボタンで
ダウンロード願います。 )
を作って currentmacrodirectory や currentmacrofilename 等のキーワードで取得を試みましたが、
いずれも空文字列が返ってきてしまって上手くいきませんでした。

当方でやりたいことは、プロジェクトに「相対パス」で登録したファイルを
{ 文字コード, 改行コード, BOM の有無 } 及び 各種読み取り専用指定 ( /b || /r || /bb || /rr ) を
指定して開くことですが、そのためにはファイルパスの所に
mac:openfile @"/bb /rr /fu8-lf-nobom """ + $filePath + @"""" ;
というようにマクロの文を入れる必要があります。しかし、このときに $filePath を .hmbook ファイル自身からの
相対パスから生成する場合に、どうしても「 .hmbook のあるディレクトリのパス」を取得しないと
いけないのですが、現状ではこれを取得する関数やキーワードが無い状態のために上手く $filePath を
導出できない状態です。



